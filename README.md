# Компас - Real Estate App

Сервис для отображения недвижимости с иерархической структурой: **Застройщик → Комплекс → Объект**.

## Архитектура

### База данных
Проект использует **MongoDB** с тремя основными коллекциями:

1. **`developers`** - застройщики
   - Основная информация: название, описание, логотип, контакты
   - Аудит: статус, время последнего обновления, источник

2. **`complexes`** - жилые комплексы
   - Связан с застройщиком через `developerId`
   - Параметры уровня комплекса: город, этажность, расстояние до моря, срок сдачи
   - Медиа: изображения комплекса

3. **`properties`** - объекты недвижимости
   - Связан с застройщиком и комплексом через `developerId` и `complexId`
   - Параметры уровня объекта: цена, площадь, этаж, комнаты, отделка, вид
   - Аудит: источник данных, внешний ID, статус

### Преимущества архитектуры
- **Производительность**: быстрая агрегация статистики по комплексам
- **Масштабируемость**: легко добавлять новые застройщики и комплексы
- **Гибкость**: параметры могут быть на разных уровнях иерархии
- **Аудит**: отслеживание изменений и источников данных

## Технологии

### Backend
- **Node.js + Express** - API сервер
- **MongoDB + Mongoose** - база данных и ODM
- **Агрегация MongoDB** - для быстрого подсчёта статистики

### Frontend
- **React** - пользовательский интерфейс
- **Vite** - сборка и разработка
- **Tailwind CSS** - стилизация
- **React Router** - навигация

## Установка и запуск

### Требования
- Node.js 16+
- MongoDB 5+
- npm или yarn

### Установка зависимостей
```bash
# Установка зависимостей фронтенда
npm install

# Установка зависимостей бэкенда
cd backend
npm install
```

### Настройка базы данных
1. Запустите MongoDB
2. Создайте базу данных `real-estate-app`
3. При необходимости настройте переменные окружения в `.env`

### Запуск
```bash
# Запуск бэкенда (порт 3001)
cd backend
npm start

# Запуск фронтенда (порт 5173)
npm run dev
```

## API Endpoints

### Застройщики
- `GET /api/developers` - список всех застройщиков со статистикой
- `GET /api/developers/:slug` - детальная информация о застройщике

### Комплексы
- `GET /api/complexes` - список комплексов с агрегированной статистикой
- `GET /api/complexes/details` - детальная информация о комплексе

### Объекты недвижимости
- `GET /api/properties` - список объектов с фильтрацией
- `GET /api/properties/ranges` - диапазоны значений для фильтров
- `GET /api/properties/filter-options` - уникальные значения для фильтров
- `POST /api/properties` - создание объекта
- `PUT /api/properties/:id` - обновление объекта
- `DELETE /api/properties/:id` - мягкое удаление объекта

## Импорт и миграция данных

### Миграция существующих данных
```bash
cd backend
node migrate_to_hierarchy.js
```

### Импорт новых данных
```bash
node import_data_mongo.js
```

Скрипты автоматически:
- Создают застройщиков и комплексы на основе данных объектов
- Обновляют связи между объектами
- Поддерживают идемпотентность (upsert)

## Фильтрация и поиск

### Фильтры по комплексам
- Застройщик, город, срок сдачи
- Диапазоны цен, площадей, этажей
- Количество комнат, тип, вид, отделка, способ оплаты

### Логика фильтрации
1. Применяются фильтры уровня комплекса (город, застройщик)
2. Для каждого комплекса агрегируется статистика по подходящим объектам
3. Комплексы без подходящих объектов исключаются из результатов

## Производительность

### Индексы MongoDB
- Составные индексы для быстрого поиска по developer + complex
- Индексы по часто используемым тегам объектов
- Уникальные индексы для предотвращения дублирования

### Агрегация
- Статистика вычисляется на уровне базы данных
- Поддержка пагинации и сортировки
- Кэширование результатов агрегации

## Разработка

### Структура проекта
```
real-estate-app/
├── backend/           # API сервер
│   ├── models/        # Mongoose модели
│   ├── routes/        # API маршруты
│   └── app.js         # Основной файл приложения
├── src/               # React приложение
│   ├── components/    # React компоненты
│   ├── utils/         # Утилиты
│   └── App.jsx        # Главный компонент
└── public/            # Статические файлы
```

### Команды разработки
```bash
# Проверка линтера
npm run lint

# Сборка для продакшена
npm run build

# Предварительный просмотр сборки
npm run preview
```

## Лицензия

MIT License








